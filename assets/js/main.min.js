(()=>{"use strict";var e;function t(t,a){e=t.dataset.type,t.toggleAttribute("active",!0),a.toggleAttribute("active",!1),t.setAttribute("aria-expanded",!0),a.setAttribute("aria-expanded",!1),document.querySelector(`.${t.dataset.type}`).toggleAttribute("active",!0),document.querySelector(`.${a.dataset.type}`).toggleAttribute("active",!1)}document.querySelector("main").addEventListener("click",(e=>{if(e.target.closest("nav")&&e.target?.dataset.type){let a=e.target?.nextElementSibling||e.target?.previousElementSibling;window.innerWidth>1024?e.target?.hasAttribute("active")||t(e.target,a):t(a,e.target)}else if(e.target.closest("section")?.id&&e.target?.dataset.type){let t=e.target.dataset.type,a="timer"===e.target.closest("section").id?q:s;if(e.target.blur(),!t||"string"!=typeof t)return;a[t]&&a[t]()}}));const a=document.querySelector("#stopwatch"),r=a.querySelectorAll(".display span");var i,n,o;const l={play:a.querySelector(".control .ph-play-fill"),pause:a.querySelector(".control .ph-pause-fill")},s={play(){c("play"),n=n?n+Date.now()-o:Date.now(),(i=new Worker("./assets/js/stopwatch.js")).postMessage(n),i.onmessage=t=>{return a=t.data,void("stopwatch"===e&&("00"!==a[3]&&(r[3].textContent=a[3]),"00"!==a[2]&&a[2]!==r[2]&&(r[2].textContent=a[2]),"00"!==a[1]&&a[1]!==r[1]&&(r[1].textContent=a[1]),"00"!==a[0]&&a[0]!==r[0]&&(r[0].textContent=a[0])));var a}},pause(){c("pause"),i.terminate(),o=Date.now()},replay(){c("pause"),n=o=!1,r[0].textContent=r[1].textContent="",r[2].textContent=r[3].textContent="00"}};function c(e){l.play.setAttribute("aria-hidden","play"===e),l.pause.setAttribute("aria-hidden","pause"===e)}const u=document.querySelector("#timer"),p=u.querySelectorAll(".display span");var d,f,y,g,h,b,S,m;f=2e3,f=3e5,b=new Audio("./assets/audio/Alarm Clock Beep.mp3"),h=JSON.parse(localStorage.getItem("isAudioEnabled"))??!0,S=JSON.parse(localStorage.getItem("isNotificationEnabled"))??!1;const A={play:u.querySelector(".control .ph-play-fill"),pause:u.querySelector(".control .ph-pause-fill"),close:u.querySelector(".control .ph-x-fill"),save:u.querySelector(".control [edit].ph-check-fill"),check:u.querySelector(".control [finish].ph-check-fill"),restart:u.querySelector(".control .ph-arrows-counter-clockwise-fill"),speakerOn:u.querySelector(".control .ph-speaker-simple-high-fill"),speakerOff:u.querySelector(".control .ph-speaker-simple-slash-fill"),bellOn:u.querySelector(".control .ph-bell-ringing-fill"),bellOff:u.querySelector(".control .ph-bell-slash-fill")},q={edit(){k("pause"),d?.terminate(),y=Date.now(),v(!0)},save(){f=function(e){let t=e.match(/.{1,2}/g);return 36e5*t[0]+6e4*t[1]+1e3*t[2]}(C()),O(),v(!1)},close(){w(x(g?g-y:f||0),!1),v(!1)},play(){"000000"===C()||f<1e3||(k("play"),g=g?g-(y-Date.now()):f+1e3+Date.now(),(d=new Worker("./assets/js/timer.js")).postMessage(g),d.onmessage=e=>{e.data?w(e.data):(d.terminate(),w("000000"),h&&b.play(),S&&(S&&(m=new Notification("Oh My Timer",{body:"Timer Finalizado!"}))),E(!0))})},pause(){k("pause"),d.terminate(),y=Date.now()},reset(){k("pause"),d?.terminate(),O(),w(x(f??0),!1)},check(){b?.pause(),m?.close(),k("pause"),O(),E(!1)},restart(){b?.pause(),m?.close(),this.reset(),E(!1),this.play()},speakerOn(){localStorage.setItem("isAudioEnabled",!1),h=!1,N()},speakerOff(){localStorage.setItem("isAudioEnabled",!0),h=!0,N()},bellOn(){localStorage.setItem("isNotificationEnabled",!1),S=!1,I()},async bellOff(){"default"===Notification.permission&&await Notification.requestPermission(),"granted"===Notification.permission&&(localStorage.setItem("isNotificationEnabled",!0),S=!0,I()),Notification.permission}};function k(e){A.play.setAttribute("aria-hidden","play"===e),A.pause.setAttribute("aria-hidden","pause"===e)}function v(e){u.querySelector(".display input").toggleAttribute("edit",e),u.querySelector(".control").toggleAttribute("edit",e),A.close.setAttribute("aria-hidden",!e),A.save.setAttribute("aria-hidden",!e)}function w(e,t=!0){let a=e.match(/.{1,2}/g);t?(p[0]!==a[0]&&(p[0].textContent=a[0]),p[1]!==a[1]&&(p[1].textContent=a[1]),p[2]!==a[2]&&(p[2].textContent=a[2])):(p[0].textContent=a[0],p[1].textContent=a[1],p[2].textContent=a[2])}function x(e){let t=Math.floor(parseInt(e/1e3)%60).toString().padStart(2,"0"),a=Math.floor(parseInt(e/6e4)%60).toString().padStart(2,"0");return`${Math.floor(parseInt(e/36e5)).toString().padStart(2,"0")}${a}${t}`}function C(){return u.querySelector(".display").textContent.replace(/\r?\n|\r/g,"").replace(/:/g,"").replaceAll(" ","")}function O(){y=g=0}function E(e){u.querySelector(".control").toggleAttribute("finish",e),A.restart.setAttribute("aria-hidden",!e),A.check.setAttribute("aria-hidden",!e)}function N(){A.speakerOn.setAttribute("aria-hidden",!h),A.speakerOff.setAttribute("aria-hidden",h)}function I(){A.bellOn.setAttribute("aria-hidden",!S),A.bellOff.setAttribute("aria-hidden",S)}const D=u.querySelector(".display input");D.addEventListener("focus",(()=>w("000000",!1))),D.onkeydown=e=>{"Enter"===e.key&&q.save()},D.addEventListener("textInput",(e=>{e.preventDefault(),isNaN(e.data)||w(C().substring(1)+e.data)})),N(),I()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQWFLLFVBQVU1RCxhQUFhLGVBQWdCOEMsR0FDcERTLEVBQWFNLFdBQVc3RCxhQUFhLGNBQWU4QyxHQUd0RCxTQUFTbUMsSUFDUDFCLEVBQWFPLE9BQU85RCxhQUFhLGVBQWdCZ0QsR0FDakRPLEVBQWFRLFFBQVEvRCxhQUFhLGNBQWVnRCxHQVduRCxNQUFNaUQsRUFBYXpELEVBQVd0QyxjQUFjLGtCQUU1QytGLEVBQVc5RixpQkFBaUIsU0FBUyxJQUFNcUUsRUFBeUIsVUFBVSxLQUU5RXlCLEVBQVdDLFVBQWFDLElBQ04sVUFBWkEsRUFBSUEsS0FBaUJyRixFQUFXMkMsUUFHdEN3QyxFQUFXOUYsaUJBQWlCLGFBQWNnRyxJQUN4Q0EsRUFBSUMsaUJBQ0FDLE1BQU1GLEVBQUloRSxPQUNkcUMsRUFBeUJGLElBQXdCZ0MsVUFBVSxHQUFLSCxFQUFJaEUsU0FLdEU2QyxJQUNBQyxLIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vb2gtbXktdGltZXIvLi9hc3NldHMvanMvbWFpbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXCIuLi9jc3MvcGhvc3Bob3IuY3NzXCI7XHJcbmltcG9ydCBcIi4uL2Nzcy9zdHlsZXMuY3NzXCI7XHJcblxyXG4vKiogKi9cclxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIm1haW5cIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xyXG4gIGlmIChldmVudC50YXJnZXQuY2xvc2VzdChcIm5hdlwiKSAmJiBldmVudC50YXJnZXQ/LmRhdGFzZXQudHlwZSkge1xyXG4gICAgbGV0IHBhcmVudCA9IGV2ZW50LnRhcmdldD8ubmV4dEVsZW1lbnRTaWJsaW5nIHx8IGV2ZW50LnRhcmdldD8ucHJldmlvdXNFbGVtZW50U2libGluZztcclxuXHJcbiAgICBpZiAod2luZG93LmlubmVyV2lkdGggPiAxMDI0KSB7XHJcbiAgICAgIGlmICghZXZlbnQudGFyZ2V0Py5oYXNBdHRyaWJ1dGUoXCJhY3RpdmVcIikpIHRvZ2dsZU5hdmlnYXRpb25TdGF0ZShldmVudC50YXJnZXQsIHBhcmVudCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0b2dnbGVOYXZpZ2F0aW9uU3RhdGUocGFyZW50LCBldmVudC50YXJnZXQpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybjtcclxuICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5jbG9zZXN0KFwic2VjdGlvblwiKT8uaWQgJiYgZXZlbnQudGFyZ2V0Py5kYXRhc2V0LnR5cGUpIHtcclxuICAgIGxldCByb2xlID0gZXZlbnQudGFyZ2V0LmRhdGFzZXQudHlwZTtcclxuICAgIGxldCBleGVjID0gZXZlbnQudGFyZ2V0LmNsb3Nlc3QoXCJzZWN0aW9uXCIpLmlkID09PSBcInRpbWVyXCIgPyB0aW1lclJvbGVzIDogc3RvcHdhdGNoUm9sZXM7XHJcblxyXG4gICAgZXZlbnQudGFyZ2V0LmJsdXIoKTtcclxuXHJcbiAgICBpZiAoIXJvbGUgfHwgdHlwZW9mIHJvbGUgIT09IFwic3RyaW5nXCIpIHJldHVybjtcclxuICAgIGlmIChleGVjW3JvbGVdKSBleGVjW3JvbGVdKCk7XHJcblxyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxufSk7XHJcblxyXG52YXIgbmF2aWdhdGlvbjtcclxuXHJcbmZ1bmN0aW9uIHRvZ2dsZU5hdmlnYXRpb25TdGF0ZSh0YXJnZXQsIHBhcmVudCkge1xyXG4gIG5hdmlnYXRpb24gPSB0YXJnZXQuZGF0YXNldC50eXBlO1xyXG5cclxuICB0YXJnZXQudG9nZ2xlQXR0cmlidXRlKFwiYWN0aXZlXCIsIHRydWUpO1xyXG4gIHBhcmVudC50b2dnbGVBdHRyaWJ1dGUoXCJhY3RpdmVcIiwgZmFsc2UpO1xyXG5cclxuICB0YXJnZXQuc2V0QXR0cmlidXRlKFwiYXJpYS1leHBhbmRlZFwiLCB0cnVlKTtcclxuICBwYXJlbnQuc2V0QXR0cmlidXRlKFwiYXJpYS1leHBhbmRlZFwiLCBmYWxzZSk7XHJcblxyXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke3RhcmdldC5kYXRhc2V0LnR5cGV9YCkudG9nZ2xlQXR0cmlidXRlKFwiYWN0aXZlXCIsIHRydWUpO1xyXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke3BhcmVudC5kYXRhc2V0LnR5cGV9YCkudG9nZ2xlQXR0cmlidXRlKFwiYWN0aXZlXCIsIGZhbHNlKTtcclxufVxyXG5cclxuLy8gU3RvcHdhdGNoXHJcblxyXG5jb25zdCBzdG9wd2F0Y2hQYW5lbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjc3RvcHdhdGNoXCIpO1xyXG5jb25zdCBzdG9wd2F0Y2hEaXNwbGF5ID0gc3RvcHdhdGNoUGFuZWwucXVlcnlTZWxlY3RvckFsbChcIi5kaXNwbGF5IHNwYW5cIik7XHJcblxyXG52YXIgc3RvcHdhdGNoV29ya2VyLCBzdG9wd2F0Y2hTdGFtcCwgc3RvcHdhdGNoRnJlZXplVGltZTtcclxuXHJcbmNvbnN0IHN0b3B3YXRjaEJ1dHRvbnMgPSB7XHJcbiAgcGxheTogc3RvcHdhdGNoUGFuZWwucXVlcnlTZWxlY3RvcihcIi5jb250cm9sIC5waC1wbGF5LWZpbGxcIiksXHJcbiAgcGF1c2U6IHN0b3B3YXRjaFBhbmVsLnF1ZXJ5U2VsZWN0b3IoXCIuY29udHJvbCAucGgtcGF1c2UtZmlsbFwiKSxcclxufTtcclxuXHJcbmNvbnN0IHN0b3B3YXRjaFJvbGVzID0ge1xyXG4gIHBsYXkoKSB7XHJcbiAgICB0b2dnbGVTdG9wd2F0Y2hCdXR0b25TdGF0ZShcInBsYXlcIik7XHJcbiAgICBzdG9wd2F0Y2hTdGFtcCA9ICFzdG9wd2F0Y2hTdGFtcCA/IERhdGUubm93KCkgOiBzdG9wd2F0Y2hTdGFtcCArIERhdGUubm93KCkgLSBzdG9wd2F0Y2hGcmVlemVUaW1lO1xyXG4gICAgc3RvcHdhdGNoV29ya2VyID0gbmV3IFdvcmtlcihcIi4vYXNzZXRzL2pzL3N0b3B3YXRjaC5qc1wiKTtcclxuICAgIHN0b3B3YXRjaFdvcmtlci5wb3N0TWVzc2FnZShzdG9wd2F0Y2hTdGFtcCk7XHJcbiAgICBzdG9wd2F0Y2hXb3JrZXIub25tZXNzYWdlID0gKG1lc3NhZ2UpID0+IHVwZGF0ZVN0b3B3YXRjaERpc3BsYXkobWVzc2FnZS5kYXRhKTtcclxuICB9LFxyXG4gIHBhdXNlKCkge1xyXG4gICAgdG9nZ2xlU3RvcHdhdGNoQnV0dG9uU3RhdGUoXCJwYXVzZVwiKTtcclxuICAgIHN0b3B3YXRjaFdvcmtlci50ZXJtaW5hdGUoKTtcclxuICAgIHN0b3B3YXRjaEZyZWV6ZVRpbWUgPSBEYXRlLm5vdygpO1xyXG4gIH0sXHJcbiAgcmVwbGF5KCkge1xyXG4gICAgdG9nZ2xlU3RvcHdhdGNoQnV0dG9uU3RhdGUoXCJwYXVzZVwiKTtcclxuICAgIHN0b3B3YXRjaFN0YW1wID0gc3RvcHdhdGNoRnJlZXplVGltZSA9IGZhbHNlO1xyXG4gICAgc3RvcHdhdGNoRGlzcGxheVswXS50ZXh0Q29udGVudCA9IHN0b3B3YXRjaERpc3BsYXlbMV0udGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgc3RvcHdhdGNoRGlzcGxheVsyXS50ZXh0Q29udGVudCA9IHN0b3B3YXRjaERpc3BsYXlbM10udGV4dENvbnRlbnQgPSBcIjAwXCI7XHJcbiAgfSxcclxufTtcclxuXHJcbmZ1bmN0aW9uIHRvZ2dsZVN0b3B3YXRjaEJ1dHRvblN0YXRlKHN0YXRlKSB7XHJcbiAgc3RvcHdhdGNoQnV0dG9ucy5wbGF5LnNldEF0dHJpYnV0ZShcImFyaWEtaGlkZGVuXCIsIHN0YXRlID09PSBcInBsYXlcIik7XHJcbiAgc3RvcHdhdGNoQnV0dG9ucy5wYXVzZS5zZXRBdHRyaWJ1dGUoXCJhcmlhLWhpZGRlblwiLCBzdGF0ZSA9PT0gXCJwYXVzZVwiKTtcclxufVxyXG5cclxuZnVuY3Rpb24gdXBkYXRlU3RvcHdhdGNoRGlzcGxheSh0aW1lKSB7XHJcbiAgaWYgKG5hdmlnYXRpb24gIT09IFwic3RvcHdhdGNoXCIpIHJldHVybjtcclxuICBpZiAodGltZVszXSAhPT0gXCIwMFwiKSBzdG9wd2F0Y2hEaXNwbGF5WzNdLnRleHRDb250ZW50ID0gdGltZVszXTtcclxuICBpZiAodGltZVsyXSAhPT0gXCIwMFwiICYmIHRpbWVbMl0gIT09IHN0b3B3YXRjaERpc3BsYXlbMl0pIHN0b3B3YXRjaERpc3BsYXlbMl0udGV4dENvbnRlbnQgPSB0aW1lWzJdO1xyXG4gIGlmICh0aW1lWzFdICE9PSBcIjAwXCIgJiYgdGltZVsxXSAhPT0gc3RvcHdhdGNoRGlzcGxheVsxXSkgc3RvcHdhdGNoRGlzcGxheVsxXS50ZXh0Q29udGVudCA9IHRpbWVbMV07XHJcbiAgaWYgKHRpbWVbMF0gIT09IFwiMDBcIiAmJiB0aW1lWzBdICE9PSBzdG9wd2F0Y2hEaXNwbGF5WzBdKSBzdG9wd2F0Y2hEaXNwbGF5WzBdLnRleHRDb250ZW50ID0gdGltZVswXTtcclxufVxyXG5cclxuLy8gVGltZXJcclxuXHJcbmNvbnN0IHRpbWVyUGFuZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3RpbWVyXCIpO1xyXG5jb25zdCB0aW1lckRpc3BsYXkgPSB0aW1lclBhbmVsLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZGlzcGxheSBzcGFuXCIpO1xyXG5cclxudmFyIHRpbWVyV29ya2VyLCB0aW1lclN0YW1wLCB0aW1lckZyZWV6ZSwgdGltZXJPbkdvaW5nLCBpc0F1ZGlvRW5hYmxlZCwgYXVkaW9GaWxlLCBpc05vdGlmaWNhdGlvbkVuYWJsZWQsIHRpbWVyTm90aWZpY2F0aW9uO1xyXG5cclxudGltZXJTdGFtcCA9IDIwMDA7IC8vIDJzXHJcbnRpbWVyU3RhbXAgPSAzMDAwMDA7IC8vIDVtXHJcblxyXG5hdWRpb0ZpbGUgPSBuZXcgQXVkaW8oXCIuL2Fzc2V0cy9hdWRpby9BbGFybSBDbG9jayBCZWVwLm1wM1wiKTtcclxuaXNBdWRpb0VuYWJsZWQgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiaXNBdWRpb0VuYWJsZWRcIikpID8/IHRydWU7XHJcbmlzTm90aWZpY2F0aW9uRW5hYmxlZCA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJpc05vdGlmaWNhdGlvbkVuYWJsZWRcIikpID8/IGZhbHNlO1xyXG5cclxuY29uc3QgdGltZXJCdXR0b25zID0ge1xyXG4gIHBsYXk6IHRpbWVyUGFuZWwucXVlcnlTZWxlY3RvcihcIi5jb250cm9sIC5waC1wbGF5LWZpbGxcIiksXHJcbiAgcGF1c2U6IHRpbWVyUGFuZWwucXVlcnlTZWxlY3RvcihcIi5jb250cm9sIC5waC1wYXVzZS1maWxsXCIpLFxyXG4gIGNsb3NlOiB0aW1lclBhbmVsLnF1ZXJ5U2VsZWN0b3IoXCIuY29udHJvbCAucGgteC1maWxsXCIpLFxyXG4gIHNhdmU6IHRpbWVyUGFuZWwucXVlcnlTZWxlY3RvcihcIi5jb250cm9sIFtlZGl0XS5waC1jaGVjay1maWxsXCIpLFxyXG4gIGNoZWNrOiB0aW1lclBhbmVsLnF1ZXJ5U2VsZWN0b3IoXCIuY29udHJvbCBbZmluaXNoXS5waC1jaGVjay1maWxsXCIpLFxyXG4gIHJlc3RhcnQ6IHRpbWVyUGFuZWwucXVlcnlTZWxlY3RvcihcIi5jb250cm9sIC5waC1hcnJvd3MtY291bnRlci1jbG9ja3dpc2UtZmlsbFwiKSxcclxuICBzcGVha2VyT246IHRpbWVyUGFuZWwucXVlcnlTZWxlY3RvcihcIi5jb250cm9sIC5waC1zcGVha2VyLXNpbXBsZS1oaWdoLWZpbGxcIiksXHJcbiAgc3BlYWtlck9mZjogdGltZXJQYW5lbC5xdWVyeVNlbGVjdG9yKFwiLmNvbnRyb2wgLnBoLXNwZWFrZXItc2ltcGxlLXNsYXNoLWZpbGxcIiksXHJcbiAgYmVsbE9uOiB0aW1lclBhbmVsLnF1ZXJ5U2VsZWN0b3IoXCIuY29udHJvbCAucGgtYmVsbC1yaW5naW5nLWZpbGxcIiksXHJcbiAgYmVsbE9mZjogdGltZXJQYW5lbC5xdWVyeVNlbGVjdG9yKFwiLmNvbnRyb2wgLnBoLWJlbGwtc2xhc2gtZmlsbFwiKSxcclxufTtcclxuXHJcbmNvbnN0IHRpbWVyUm9sZXMgPSB7XHJcbiAgZWRpdCgpIHtcclxuICAgIHRvZ2dsZVRpbWVyQnV0dG9uU3RhdGUoXCJwYXVzZVwiKTtcclxuICAgIHRpbWVyV29ya2VyPy50ZXJtaW5hdGUoKTtcclxuICAgIHRpbWVyRnJlZXplID0gRGF0ZS5ub3coKTtcclxuICAgIHRvZ2dsZVRpbWVyRWRpdG9yKHRydWUpO1xyXG4gIH0sXHJcbiAgc2F2ZSgpIHtcclxuICAgIHRpbWVyU3RhbXAgPSBwYXJzZVRpbWVyU3RyaW5nVG9TdGFtcChnZXRUaW1lckRpc3BsYXlTdHJpbmcoKSk7XHJcbiAgICByZXNldFRpbWVyQ2xvY2tWYXJpYWJsZXMoKTtcclxuICAgIHRvZ2dsZVRpbWVyRWRpdG9yKGZhbHNlKTtcclxuICB9LFxyXG4gIGNsb3NlKCkge1xyXG4gICAgbGV0IHRpbWUgPSB0aW1lck9uR29pbmcgPyB0aW1lck9uR29pbmcgLSB0aW1lckZyZWV6ZSA6IHRpbWVyU3RhbXAgPyB0aW1lclN0YW1wIDogMDtcclxuICAgIHB1c2hTdHJpbmdUb1RpbWVyRGlzcGxheShwYXJzZVRpbWVyU3RhbXBUb1N0cmluZyh0aW1lKSwgZmFsc2UpO1xyXG4gICAgdG9nZ2xlVGltZXJFZGl0b3IoZmFsc2UpO1xyXG4gIH0sXHJcbiAgcGxheSgpIHtcclxuICAgIGlmIChnZXRUaW1lckRpc3BsYXlTdHJpbmcoKSA9PT0gXCIwMDAwMDBcIiB8fCB0aW1lclN0YW1wIDwgMTAwMCkgcmV0dXJuO1xyXG4gICAgdG9nZ2xlVGltZXJCdXR0b25TdGF0ZShcInBsYXlcIik7XHJcbiAgICB0aW1lck9uR29pbmcgPSAhdGltZXJPbkdvaW5nID8gdGltZXJTdGFtcCArIDEwMDAgKyBEYXRlLm5vdygpIDogdGltZXJPbkdvaW5nIC0gKHRpbWVyRnJlZXplIC0gRGF0ZS5ub3coKSk7XHJcbiAgICB0aW1lcldvcmtlciA9IG5ldyBXb3JrZXIoXCIuL2Fzc2V0cy9qcy90aW1lci5qc1wiKTtcclxuICAgIHRpbWVyV29ya2VyLnBvc3RNZXNzYWdlKHRpbWVyT25Hb2luZyk7XHJcbiAgICB0aW1lcldvcmtlci5vbm1lc3NhZ2UgPSAobWVzc2FnZSkgPT4ge1xyXG4gICAgICBpZiAoIW1lc3NhZ2UuZGF0YSkge1xyXG4gICAgICAgIHRpbWVyV29ya2VyLnRlcm1pbmF0ZSgpO1xyXG4gICAgICAgIHB1c2hTdHJpbmdUb1RpbWVyRGlzcGxheShcIjAwMDAwMFwiKTtcclxuICAgICAgICBpZiAoaXNBdWRpb0VuYWJsZWQpIGF1ZGlvRmlsZS5wbGF5KCk7XHJcbiAgICAgICAgaWYgKGlzTm90aWZpY2F0aW9uRW5hYmxlZCkgcHVzaFRpbWVyTm90aWZpY2F0aW9uKCk7XHJcbiAgICAgICAgdG9nZ2xlRmluaXNoVGltZXIodHJ1ZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcHVzaFN0cmluZ1RvVGltZXJEaXNwbGF5KG1lc3NhZ2UuZGF0YSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfSxcclxuICBwYXVzZSgpIHtcclxuICAgIHRvZ2dsZVRpbWVyQnV0dG9uU3RhdGUoXCJwYXVzZVwiKTtcclxuICAgIHRpbWVyV29ya2VyLnRlcm1pbmF0ZSgpO1xyXG4gICAgdGltZXJGcmVlemUgPSBEYXRlLm5vdygpO1xyXG4gIH0sXHJcbiAgcmVzZXQoKSB7XHJcbiAgICB0b2dnbGVUaW1lckJ1dHRvblN0YXRlKFwicGF1c2VcIik7XHJcbiAgICB0aW1lcldvcmtlcj8udGVybWluYXRlKCk7XHJcbiAgICByZXNldFRpbWVyQ2xvY2tWYXJpYWJsZXMoKTtcclxuICAgIHB1c2hTdHJpbmdUb1RpbWVyRGlzcGxheShwYXJzZVRpbWVyU3RhbXBUb1N0cmluZyh0aW1lclN0YW1wID8/IDApLCBmYWxzZSk7XHJcbiAgfSxcclxuICBjaGVjaygpIHtcclxuICAgIGF1ZGlvRmlsZT8ucGF1c2UoKTtcclxuICAgIHRpbWVyTm90aWZpY2F0aW9uPy5jbG9zZSgpO1xyXG4gICAgdG9nZ2xlVGltZXJCdXR0b25TdGF0ZShcInBhdXNlXCIpO1xyXG4gICAgcmVzZXRUaW1lckNsb2NrVmFyaWFibGVzKCk7XHJcbiAgICB0b2dnbGVGaW5pc2hUaW1lcihmYWxzZSk7XHJcbiAgfSxcclxuICByZXN0YXJ0KCkge1xyXG4gICAgYXVkaW9GaWxlPy5wYXVzZSgpO1xyXG4gICAgdGltZXJOb3RpZmljYXRpb24/LmNsb3NlKCk7XHJcbiAgICB0aGlzLnJlc2V0KCk7XHJcbiAgICB0b2dnbGVGaW5pc2hUaW1lcihmYWxzZSk7XHJcbiAgICB0aGlzLnBsYXkoKTtcclxuICB9LFxyXG4gIHNwZWFrZXJPbigpIHtcclxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiaXNBdWRpb0VuYWJsZWRcIiwgZmFsc2UpO1xyXG4gICAgaXNBdWRpb0VuYWJsZWQgPSBmYWxzZTtcclxuICAgIHRvZ2dsZVRpbWVyU3BlYWtlcigpO1xyXG4gIH0sXHJcbiAgc3BlYWtlck9mZigpIHtcclxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiaXNBdWRpb0VuYWJsZWRcIiwgdHJ1ZSk7XHJcbiAgICBpc0F1ZGlvRW5hYmxlZCA9IHRydWU7XHJcbiAgICB0b2dnbGVUaW1lclNwZWFrZXIoKTtcclxuICB9LFxyXG4gIGJlbGxPbigpIHtcclxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiaXNOb3RpZmljYXRpb25FbmFibGVkXCIsIGZhbHNlKTtcclxuICAgIGlzTm90aWZpY2F0aW9uRW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgdG9nZ2xlVGltZXJOb3RpZmljYXRpb24oKTtcclxuICB9LFxyXG4gIGFzeW5jIGJlbGxPZmYoKSB7XHJcbiAgICBpZiAoTm90aWZpY2F0aW9uLnBlcm1pc3Npb24gPT09IFwiZGVmYXVsdFwiKSB7XHJcbiAgICAgIGF3YWl0IE5vdGlmaWNhdGlvbi5yZXF1ZXN0UGVybWlzc2lvbigpO1xyXG4gICAgfVxyXG4gICAgaWYgKE5vdGlmaWNhdGlvbi5wZXJtaXNzaW9uID09PSBcImdyYW50ZWRcIikge1xyXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImlzTm90aWZpY2F0aW9uRW5hYmxlZFwiLCB0cnVlKTtcclxuICAgICAgaXNOb3RpZmljYXRpb25FbmFibGVkID0gdHJ1ZTtcclxuICAgICAgdG9nZ2xlVGltZXJOb3RpZmljYXRpb24oKTtcclxuICAgIH1cclxuICAgIGlmIChOb3RpZmljYXRpb24ucGVybWlzc2lvbiA9PT0gXCJkZW5pZWRcIikge1xyXG4gICAgICAvLyBzaGFrZSB0aGUgaWNvblxyXG4gICAgfVxyXG4gIH0sXHJcbn07XHJcblxyXG5mdW5jdGlvbiB0b2dnbGVUaW1lckJ1dHRvblN0YXRlKHN0YXRlKSB7XHJcbiAgdGltZXJCdXR0b25zLnBsYXkuc2V0QXR0cmlidXRlKFwiYXJpYS1oaWRkZW5cIiwgc3RhdGUgPT09IFwicGxheVwiKTtcclxuICB0aW1lckJ1dHRvbnMucGF1c2Uuc2V0QXR0cmlidXRlKFwiYXJpYS1oaWRkZW5cIiwgc3RhdGUgPT09IFwicGF1c2VcIik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRvZ2dsZVRpbWVyRWRpdG9yKHN0YXRlKSB7XHJcbiAgdGltZXJQYW5lbC5xdWVyeVNlbGVjdG9yKFwiLmRpc3BsYXkgaW5wdXRcIikudG9nZ2xlQXR0cmlidXRlKFwiZWRpdFwiLCBzdGF0ZSk7XHJcbiAgdGltZXJQYW5lbC5xdWVyeVNlbGVjdG9yKFwiLmNvbnRyb2xcIikudG9nZ2xlQXR0cmlidXRlKFwiZWRpdFwiLCBzdGF0ZSk7XHJcbiAgdGltZXJCdXR0b25zLmNsb3NlLnNldEF0dHJpYnV0ZShcImFyaWEtaGlkZGVuXCIsICFzdGF0ZSk7XHJcbiAgdGltZXJCdXR0b25zLnNhdmUuc2V0QXR0cmlidXRlKFwiYXJpYS1oaWRkZW5cIiwgIXN0YXRlKTtcclxufVxyXG5cclxuZnVuY3Rpb24gcHVzaFN0cmluZ1RvVGltZXJEaXNwbGF5KHN0cmluZywgY29tcGFyZSA9IHRydWUpIHtcclxuICBsZXQgYXJyYXkgPSBzdHJpbmcubWF0Y2goLy57MSwyfS9nKTtcclxuXHJcbiAgaWYgKGNvbXBhcmUpIHtcclxuICAgIGlmICh0aW1lckRpc3BsYXlbMF0gIT09IGFycmF5WzBdKSB0aW1lckRpc3BsYXlbMF0udGV4dENvbnRlbnQgPSBhcnJheVswXTtcclxuICAgIGlmICh0aW1lckRpc3BsYXlbMV0gIT09IGFycmF5WzFdKSB0aW1lckRpc3BsYXlbMV0udGV4dENvbnRlbnQgPSBhcnJheVsxXTtcclxuICAgIGlmICh0aW1lckRpc3BsYXlbMl0gIT09IGFycmF5WzJdKSB0aW1lckRpc3BsYXlbMl0udGV4dENvbnRlbnQgPSBhcnJheVsyXTtcclxuICB9IGVsc2Uge1xyXG4gICAgdGltZXJEaXNwbGF5WzBdLnRleHRDb250ZW50ID0gYXJyYXlbMF07XHJcbiAgICB0aW1lckRpc3BsYXlbMV0udGV4dENvbnRlbnQgPSBhcnJheVsxXTtcclxuICAgIHRpbWVyRGlzcGxheVsyXS50ZXh0Q29udGVudCA9IGFycmF5WzJdO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcGFyc2VUaW1lclN0cmluZ1RvU3RhbXAoc3RyaW5nKSB7XHJcbiAgbGV0IHRpbWUgPSBzdHJpbmcubWF0Y2goLy57MSwyfS9nKTtcclxuICByZXR1cm4gdGltZVswXSAqIDM2MDAwMDAgKyB0aW1lWzFdICogNjAwMDAgKyB0aW1lWzJdICogMTAwMDtcclxufVxyXG5cclxuZnVuY3Rpb24gcGFyc2VUaW1lclN0YW1wVG9TdHJpbmcoc3RhbXApIHtcclxuICBsZXQgc2VjID0gTWF0aC5mbG9vcihwYXJzZUludChzdGFtcCAvIDEwMDApICUgNjApXHJcbiAgICAudG9TdHJpbmcoKVxyXG4gICAgLnBhZFN0YXJ0KDIsIFwiMFwiKTtcclxuICBsZXQgbWluID0gTWF0aC5mbG9vcihwYXJzZUludChzdGFtcCAvIDYwMDAwKSAlIDYwKVxyXG4gICAgLnRvU3RyaW5nKClcclxuICAgIC5wYWRTdGFydCgyLCBcIjBcIik7XHJcbiAgbGV0IGhvdXIgPSBNYXRoLmZsb29yKHBhcnNlSW50KHN0YW1wIC8gMzYwMDAwMCkpXHJcbiAgICAudG9TdHJpbmcoKVxyXG4gICAgLnBhZFN0YXJ0KDIsIFwiMFwiKTtcclxuXHJcbiAgcmV0dXJuIGAke2hvdXJ9JHttaW59JHtzZWN9YDtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0VGltZXJEaXNwbGF5U3RyaW5nKCkge1xyXG4gIHJldHVybiB0aW1lclBhbmVsXHJcbiAgICAucXVlcnlTZWxlY3RvcihcIi5kaXNwbGF5XCIpXHJcbiAgICAudGV4dENvbnRlbnQucmVwbGFjZSgvXFxyP1xcbnxcXHIvZywgXCJcIilcclxuICAgIC5yZXBsYWNlKC86L2csIFwiXCIpXHJcbiAgICAucmVwbGFjZUFsbChcIiBcIiwgXCJcIik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlc2V0VGltZXJDbG9ja1ZhcmlhYmxlcygpIHtcclxuICB0aW1lckZyZWV6ZSA9IHRpbWVyT25Hb2luZyA9IDA7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRvZ2dsZUZpbmlzaFRpbWVyKHN0YXRlKSB7XHJcbiAgdGltZXJQYW5lbC5xdWVyeVNlbGVjdG9yKFwiLmNvbnRyb2xcIikudG9nZ2xlQXR0cmlidXRlKFwiZmluaXNoXCIsIHN0YXRlKTtcclxuICB0aW1lckJ1dHRvbnMucmVzdGFydC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWhpZGRlblwiLCAhc3RhdGUpO1xyXG4gIHRpbWVyQnV0dG9ucy5jaGVjay5zZXRBdHRyaWJ1dGUoXCJhcmlhLWhpZGRlblwiLCAhc3RhdGUpO1xyXG59XHJcblxyXG5mdW5jdGlvbiB0b2dnbGVUaW1lclNwZWFrZXIoKSB7XHJcbiAgdGltZXJCdXR0b25zLnNwZWFrZXJPbi5zZXRBdHRyaWJ1dGUoXCJhcmlhLWhpZGRlblwiLCAhaXNBdWRpb0VuYWJsZWQpO1xyXG4gIHRpbWVyQnV0dG9ucy5zcGVha2VyT2ZmLnNldEF0dHJpYnV0ZShcImFyaWEtaGlkZGVuXCIsIGlzQXVkaW9FbmFibGVkKTtcclxufVxyXG5cclxuZnVuY3Rpb24gdG9nZ2xlVGltZXJOb3RpZmljYXRpb24oKSB7XHJcbiAgdGltZXJCdXR0b25zLmJlbGxPbi5zZXRBdHRyaWJ1dGUoXCJhcmlhLWhpZGRlblwiLCAhaXNOb3RpZmljYXRpb25FbmFibGVkKTtcclxuICB0aW1lckJ1dHRvbnMuYmVsbE9mZi5zZXRBdHRyaWJ1dGUoXCJhcmlhLWhpZGRlblwiLCBpc05vdGlmaWNhdGlvbkVuYWJsZWQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwdXNoVGltZXJOb3RpZmljYXRpb24oKSB7XHJcbiAgaWYgKCFpc05vdGlmaWNhdGlvbkVuYWJsZWQpIHJldHVybjtcclxuXHJcbiAgdGltZXJOb3RpZmljYXRpb24gPSBuZXcgTm90aWZpY2F0aW9uKFwiT2ggTXkgVGltZXJcIiwgeyBib2R5OiBcIlRpbWVyIEZpbmFsaXphZG8hXCIgfSk7XHJcbn1cclxuXHJcbi8vIFRpbWVyIElucHV0XHJcblxyXG5jb25zdCB0aW1lcklucHV0ID0gdGltZXJQYW5lbC5xdWVyeVNlbGVjdG9yKFwiLmRpc3BsYXkgaW5wdXRcIik7XHJcblxyXG50aW1lcklucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJmb2N1c1wiLCAoKSA9PiBwdXNoU3RyaW5nVG9UaW1lckRpc3BsYXkoXCIwMDAwMDBcIiwgZmFsc2UpKTtcclxuXHJcbnRpbWVySW5wdXQub25rZXlkb3duID0gKGtleSkgPT4ge1xyXG4gIGlmIChrZXkua2V5ID09PSBcIkVudGVyXCIpIHRpbWVyUm9sZXMuc2F2ZSgpO1xyXG59O1xyXG5cclxudGltZXJJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwidGV4dElucHV0XCIsIChrZXkpID0+IHtcclxuICBrZXkucHJldmVudERlZmF1bHQoKTtcclxuICBpZiAoaXNOYU4oa2V5LmRhdGEpKSByZXR1cm47XHJcbiAgcHVzaFN0cmluZ1RvVGltZXJEaXNwbGF5KGdldFRpbWVyRGlzcGxheVN0cmluZygpLnN1YnN0cmluZygxKSArIGtleS5kYXRhKTtcclxufSk7XHJcblxyXG4vLyBVcGRhdGUgVUkgYWZ0ZXIgc2V0dXBcclxuXHJcbnRvZ2dsZVRpbWVyU3BlYWtlcigpO1xyXG50b2dnbGVUaW1lck5vdGlmaWNhdGlvbigpO1xyXG4iXSwibmFtZXMiOlsibmF2aWdhdGlvbiIsInRvZ2dsZU5hdmlnYXRpb25TdGF0ZSIsInRhcmdldCIsInBhcmVudCIsImRhdGFzZXQiLCJ0eXBlIiwidG9nZ2xlQXR0cmlidXRlIiwic2V0QXR0cmlidXRlIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiY2xvc2VzdCIsIm5leHRFbGVtZW50U2libGluZyIsInByZXZpb3VzRWxlbWVudFNpYmxpbmciLCJ3aW5kb3ciLCJpbm5lcldpZHRoIiwiaGFzQXR0cmlidXRlIiwiaWQiLCJyb2xlIiwiZXhlYyIsInRpbWVyUm9sZXMiLCJzdG9wd2F0Y2hSb2xlcyIsImJsdXIiLCJzdG9wd2F0Y2hQYW5lbCIsInN0b3B3YXRjaERpc3BsYXkiLCJxdWVyeVNlbGVjdG9yQWxsIiwic3RvcHdhdGNoV29ya2VyIiwic3RvcHdhdGNoU3RhbXAiLCJzdG9wd2F0Y2hGcmVlemVUaW1lIiwic3RvcHdhdGNoQnV0dG9ucyIsInBsYXkiLCJwYXVzZSIsInRvZ2dsZVN0b3B3YXRjaEJ1dHRvblN0YXRlIiwiRGF0ZSIsIm5vdyIsIldvcmtlciIsInBvc3RNZXNzYWdlIiwib25tZXNzYWdlIiwibWVzc2FnZSIsInVwZGF0ZVN0b3B3YXRjaERpc3BsYXkiLCJ0aW1lIiwiZGF0YSIsInRleHRDb250ZW50IiwidGVybWluYXRlIiwicmVwbGF5Iiwic3RhdGUiLCJ0aW1lclBhbmVsIiwidGltZXJEaXNwbGF5IiwidGltZXJXb3JrZXIiLCJ0aW1lclN0YW1wIiwidGltZXJGcmVlemUiLCJ0aW1lck9uR29pbmciLCJpc0F1ZGlvRW5hYmxlZCIsImF1ZGlvRmlsZSIsImlzTm90aWZpY2F0aW9uRW5hYmxlZCIsInRpbWVyTm90aWZpY2F0aW9uIiwiQXVkaW8iLCJKU09OIiwicGFyc2UiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwidGltZXJCdXR0b25zIiwiY2xvc2UiLCJzYXZlIiwiY2hlY2siLCJyZXN0YXJ0Iiwic3BlYWtlck9uIiwic3BlYWtlck9mZiIsImJlbGxPbiIsImJlbGxPZmYiLCJlZGl0IiwidG9nZ2xlVGltZXJCdXR0b25TdGF0ZSIsInRvZ2dsZVRpbWVyRWRpdG9yIiwic3RyaW5nIiwibWF0Y2giLCJwYXJzZVRpbWVyU3RyaW5nVG9TdGFtcCIsImdldFRpbWVyRGlzcGxheVN0cmluZyIsInJlc2V0VGltZXJDbG9ja1ZhcmlhYmxlcyIsInB1c2hTdHJpbmdUb1RpbWVyRGlzcGxheSIsInBhcnNlVGltZXJTdGFtcFRvU3RyaW5nIiwiTm90aWZpY2F0aW9uIiwiYm9keSIsInRvZ2dsZUZpbmlzaFRpbWVyIiwicmVzZXQiLCJ0aGlzIiwic2V0SXRlbSIsInRvZ2dsZVRpbWVyU3BlYWtlciIsInRvZ2dsZVRpbWVyTm90aWZpY2F0aW9uIiwiYXN5bmMiLCJwZXJtaXNzaW9uIiwicmVxdWVzdFBlcm1pc3Npb24iLCJjb21wYXJlIiwiYXJyYXkiLCJzdGFtcCIsInNlYyIsIk1hdGgiLCJmbG9vciIsInBhcnNlSW50IiwidG9TdHJpbmciLCJwYWRTdGFydCIsIm1pbiIsInJlcGxhY2UiLCJyZXBsYWNlQWxsIiwidGltZXJJbnB1dCIsIm9ua2V5ZG93biIsImtleSIsInByZXZlbnREZWZhdWx0IiwiaXNOYU4iLCJzdWJzdHJpbmciXSwic291cmNlUm9vdCI6IiJ9